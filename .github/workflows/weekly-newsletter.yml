name: Developer Tools Newsletter (Every Other Day)

on:
  # Run every other day at 10 AM UTC (Monday, Wednesday, Friday, Sunday)
  schedule:
    - cron: '0 10 * * 1,3,5,0'
  
  # Allow manual trigger for testing
  workflow_dispatch:

jobs:
  generate-newsletter:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests
        
    - name: Generate newsletter
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        NVIDIA_API_KEY: ${{ secrets.NVIDIA_API_KEY }}
      run: |
        python automation/simple_automation.py
        
    - name: Commit and push newsletter
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add newsletter/auto-generated-week-*.md
        git commit -m "ğŸ¤– Auto-generated newsletter - $(date +%Y-%m-%d)" || exit 0
        git push
        
    - name: Create Issue with Newsletter Content
      uses: actions/github-script@v7
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          const fs = require('fs');
          const path = require('path');
          
          // Find the latest newsletter file
          const newsletterDir = 'newsletter';
          const files = fs.readdirSync(newsletterDir)
            .filter(file => file.startsWith('auto-generated-week-'))
            .sort()
            .reverse();
          
          if (files.length > 0) {
            const latestFile = files[0];
            const newsletterContent = fs.readFileSync(path.join(newsletterDir, latestFile), 'utf8');
            
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: `ğŸ“§ Newsletter Ready - ${new Date().toISOString().slice(0, 10)}`,
              body: `## ğŸš€ Your Developer Tools Newsletter is Ready!

> ğŸ‘‹ **Hey GitHub visitors!** This is a **FREE preview** of our developer tools newsletter. Want the **full experience** with exclusive founder interviews, live demos, and early access to trending tools? [**Subscribe here for free!**](YOUR_NEWSLETTER_LINK)

**Copy-paste ready content below:**

---

${newsletterContent}

---

## ğŸ“‹ Next Steps (For Newsletter Owner):
1. **Copy** the content above
2. **Paste** into your newsletter editor (Substack, ConvertKit, etc.)
3. **Send** to your subscribers!

---

## ğŸ¯ Want More Premium Content Like This?

### ğŸŒŸ **Subscribe to Our Newsletter for Exclusive Access:**
- ğŸ¤ **Founder Interviews**: 1-on-1 with creators of trending tools
- ğŸ“¹ **Live Product Demos**: Watch tools in action before everyone else  
- ğŸª **Monthly Webinars**: Q&A with dev tool leaders
- ğŸ’¡ **Early Access**: See tools before they hit GitHub trending
- ğŸ“Š **Deep Analysis**: Market insights and investment patterns
- ğŸ”¥ **Community**: Join 10,000+ developers and VCs

ğŸ‘‰ **[Subscribe Free - No Spam, Just Value](YOUR_NEWSLETTER_LINK)**

---

### ğŸ“ File Location: \`${latestFile}\`
### ğŸ¤– *This issue was automatically created by our newsletter automation system*

**â­ Like what you see? Star this repo and follow for daily updates!**`,
              labels: ['newsletter', 'automation', 'ready-to-send']
            });
          }